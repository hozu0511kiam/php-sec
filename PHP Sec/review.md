# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
ユーザーのアクセス時に表示内容が生成される「動的Webページ」の脆弱性、もしくはその脆弱性を利用した攻撃方法のこと。

ユーザーからの入力データを表示する仕組みになっている、インターネット掲示板やショッピングサイトのようなWebアプリケーションで特に発生しやすい攻撃。攻撃者が罠を準備したWebサイトにアクセスすると、ユーザーのブラウザー実行され、意図せず攻撃者による被害を受けてしまう。
偽のログインフォームに誘導されて入力したパスワードを盗み取られたり、ユーザーに関する情報が盗まれ、乗っ取りやネットバンクでの不正な出金といった被害を受けてしまう危険性があるため、攻撃者にとっては個人情報の搾取・悪用ができるというメリットがある。

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。
e()の引数に変数$textを指定することで、フォームを送信されたときは毎回エスケープ処理を返すことができる。

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。
HTMLの中では特殊な意味を持つため直接書くことが出来ない記号等を、正しく画面に記号出力を文字として表示できるような形に変換できるようになるため、スクリプトが文字として扱われ、確認画面にそのまま表示することができるようになるため。

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
不特定多数の人に対して意図しないリクエスト送信をさせる攻撃。
ユーザーに不正なスクリプトを実行させるXSSとは異なり、ユーザーのログインした状態を悪用し、リクエストを偽装する。例えば、AmazonやSNSにログインしたままのユーザーのセッション情報を乗っ取り、ユーザーのリクエストを偽装して本人がログインしているかのような操作（商品の購入やパスワードの変更など）を不正に行うため、本来ならユーザー自身がログインしなければ行えない情報の変更や入出金などの操作が可能。

### SessionとCookieの違いを説明してください。
セッションはサーバーにデータを保存するのに対し、クッキーはブラウザ側に保存する

### `setToken()`が何をしているか説明してください。
openssl_random_pseudo_bytes(16)でランダムな16文字のバイト文字列を生成し、bin2hexで16進数に変換した値を$_SESSION['token']に格納

### `checkToken()`が何をしているか説明してください
新規作成と更新でデータが送信された時に呼び出して確認することでサーバ側とクライアント側のtokenの整合性を判断している
サーバーが受け取ったトークンとセッション内のトークンを比較し、一致すればリクエストを許可、異なるトークンでPOSTされたときは不正アクセスとして攻撃者が不正なリクエストを送信することを防ぐ

### トークンを使うことでなぜCSRFが防げるのか説明してください。
ウェブアプリケーションがユーザーのセッションごとに生成してランダムに埋め込むため、リクエストが本当にユーザー自身からのものであることを確認できる
CSRFトークンは、ユーザーが送信するすべてのリクエストに含まれ、サーバーはそのトークンを検証する
トークンが一致しない場合、リクエストは拒否されるため、攻撃者がユーザーのセッションを乗っ取ることを防ぐことができる

## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。
SQL（Structured Query Language）を実行する際に、文字として入力した値がSQL文に結合できる命令文だった時、開発者の想定していない結果をもたらしてしまうこと
万が一悪意のあるユーザーによって不正な値が入力されてしまうと、データベースに保存されている情報が削除されたり、盗まれたるする危険性がある

### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。
prepare()はPDOStatementオブジェクトを返す
SQL文を実行する準備をする

### `->bindValue()`が何をしているか説明してください。
prepare()の返り値のPDOStatementオブジェクトにSQL文を実行し、成功した場合はtrue、失敗した場合はfalseを返す

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。
ユーザーが入力したデータのデータ型を指定し、文字列として認識させ、SQL文が開発者の想定する結果から外れることを防ぐことができる

## バリデーション

### バリデーションの目的について説明してください。
必ず入力してほしい項目や、入力時に指定したい制限（記号の制限や文字数など）があるときに、入力形式のチェックをするため

### `validate()`が何をしているか説明してください。
savePostedDataの分岐処理をする際に、[content]内の入力がないときは「入力がありません」とエラー表示をするようにしている

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。
issetはcontentキーのデータが送られていなかった時(削除機能の時)にfalseを返す
issetがある条件式の右側の$post['content'] === '' 削除時に右側条件式を判定してしまうとエラーが発生するため、先にissetでfalseを返して条件判定を中断している

## その他

### `unsetError()`を実行しないとどうなるか説明してください。
unset() は指定した変数を破棄する関数
SESSION のキーであるerrに格納したエラーメッセージを空文字にして、ブラウザ上にエラーメッセージを表示させないようにするために定義している
