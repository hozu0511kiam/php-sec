# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

入力フォーム「スクリプト（javaScript）」を埋め込む攻撃

害：Webサイトが意図しない動きをする
なぜ：HTML において特殊な意味を持つ文字があるから→&、"、'、<、>
対策：エスケープ処理（htmlspecialchars関数を使う）→意味を持つ文字を別文字に変換する

攻撃者のメリット：個人情報の搾取・悪用ができる
例：ユーザーに関する情報の取得→パスワードの取得による乗っ取り、ネットバンクでの不正な出金

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。
1 入力する際の文字数を小さくできること
2 引数を共通化できること（訂正があった際に、まとめて修正できる）

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。
HTMLの中では特殊な意味を持つため直接書くことが出来ない記号等を、正しく画面に記号出力を文字として表示できるような形に変換できるようになるため、スクリプトが文字として扱われ、確認画面にそのまま表示することができるようになるため。

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

Cross Site Request Forgery
サイトをまたいでリクエストを偽造する

害：意図しないデータが入力される
なぜ：意図しない場所からリクエストするから
対策：SESSIONでのトークンの比較でリクエストを防ぐ
攻撃者のメリット：本来ならユーザー自身でなければ行えない情報の変更や入力が可能。
例：AmazonやSNSにログインしたままのユーザーのセッション情報を乗っ取り、ユーザーのリクエストを偽装して本人がログインしているかのような操作（商品の購入やパスワードの変更など）を不正に行う

### SessionとCookieの違いを説明してください。
セッションはサーバーにデータを保存するのに対し、クッキーはブラウザ側に保存する

### `setToken()`が何をしているか説明してください。
openssl_random_pseudo_bytes(16)でランダムな16文字のバイト文字列を生成し、bin2hexで16進数に変換した値を$_SESSION['token']に格納

### `checkToken()`が何をしているか説明してください
新規作成と更新でデータが送信された時に呼び出して確認することでサーバ側とクライアント側のtokenの整合性を判断している
サーバーが受け取ったトークンとセッション内のトークンを比較し、一致すればリクエストを許可、異なるトークンでPOSTされたときは不正アクセスとして攻撃者が不正なリクエストを送信することを防ぐ

### トークンを使うことでなぜCSRFが防げるのか説明してください。

CSRFトークンは、ユーザーが送信するすべてのリクエストに含まれ、サーバーはそのトークンを検証する

ユーザーのセッションごとに生成してランダムに埋め込むため、リクエストが本当にユーザー自身からのものであるか確認できる

トークンが一致しない場合のリクエストは拒否するため、攻撃者がユーザーのセッションを乗っ取ることを防ぐ

## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

入力フォームからSQLを送信して、意図しないSQLを実行させる

害：取得・追加・削除…
なぜ：入力フォームに入力した値がSQLに結合できる命令文だった時、意図しない実行をもたらすから
対策：プレースホルダー→SQLに値を後から入れることでSQLの書き換えを防ぐ
攻撃者のメリット：データベースに保存されている情報が削除されたり、盗まれたるする危険性がある
例："UPDATE"や"INSERT"などのMYSQLにSQLを伝える（prepare）が入力されると、意図しないSQL文が作動してしまう


### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。
prepare()はPDOStatementオブジェクトを返す
SQL文を実行する準備をする

### `->bindValue()`が何をしているか説明してください。
prepare()の返り値のPDOStatementオブジェクトにSQL文を実行し、成功した場合はtrue、失敗した場合はfalseを返す

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。
ユーザーが入力したデータのデータ型を指定し、文字列として認識させ、SQL文が開発者の想定する結果から外れることを防ぐことができる

## バリデーション

### バリデーションの目的について説明してください。
必ず入力してほしい項目や、入力時に指定したい制限（記号の制限や文字数など）があるときに、入力形式のチェックをするため

### `validate()`が何をしているか説明してください。
savePostedDataの分岐処理をする際に、[content]内の入力がないときは「入力がありません」とエラー表示をするようにしている

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。
issetはcontentキーのデータが送られていなかった時(削除機能の時)にfalseを返す
issetがある条件式の右側の$post['content'] === '' 削除時に右側条件式を判定してしまうとエラーが発生するため、先にissetでfalseを返して条件判定を中断している

## その他

### `unsetError()`を実行しないとどうなるか説明してください。
unset() は指定した変数を破棄する関数
SESSION のキーであるerrに格納したエラーメッセージを空文字にして、ブラウザ上にエラーメッセージを表示させないようにするために定義している
